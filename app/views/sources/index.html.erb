<%= render 'table_filter', source: @source %>

<h1>Sources</h1>

</br>

<% if user_signed_in? && current_user.admin? %>
<div class="container">
<%= link_to 'New Source', new_source_path, class: "btn btn-success" %>
</div>
</br>
<%end%>

<div class="accordion" id="accordionFilter">
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingOne">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
        Class Filters
      </button>
    </h2>
    <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne">
      <div class="accordion-body">
        <!--Checkboxes for Source Class filtering-->
        <div class="row">
          <div class="col-md-1">
            <div class="form-check form-switch form-check-inline">
              <input class="form-check-input" type="checkbox" id="LBL" name="LBL" value="yes" checked>
              <label class="form-check-label" for="LBL"> LBL </label>
            </div>
          </div>
          <div class="col-md-1">
            <div class="form-check form-switch form-check-inline">
              <input class="form-check-input" type="checkbox" id="IBL" name="IBL" value="yes" checked>
              <label class="form-check-label" for="IBL"> IBL </label>
            </div>
          </div>
          <div class="col-md-1">
            <div class="form-check form-switch form-check-inline">
              <input class="form-check-input" type="checkbox" id="HBL" name="HBL" value="yes" checked> 
              <label class="form-check-label" for="HBL"> HBL </label>
            </div>
          </div>
          <div class="col-md-1">
            <div class="form-check form-switch form-check-inline">
              <input class="form-check-input" type="checkbox" id="XBL" name="XBL" value="yes" checked> 
              <label class="form-check-label" for="XBL"> XBL </label>
            </div>
          </div>
          <div class="col-md-1">
            <div class="form-check form-switch form-check-inline">
              <input class="form-check-input" type="checkbox" id="FSRQ" name="FSRQ" value="yes" checked> 
              <label class="form-check-label" for="FSRQ"> FSRQ</label>
            </div>
          </div>
          <div class="col-md-1">
            <div class="form-check form-switch form-check-inline">
              <input class="form-check-input" type="checkbox" id="RG" name="RG" value="yes" checked> 
              <label class="form-check-label" for="RG"> RG</label>
            </div>
          </div>
          <div class="col-md-1">
            <div class="form-check form-switch form-check-inline">
              <input class="form-check-input" type="checkbox" id="other_class" name="other_class" value="yes" checked> 
              <label class="form-check-label" for="other_class"> Other</label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="accordion-item">
    <h2 class="accordion-header" id="headingTwo">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
        Category Filters
      </button>
    </h2>
    <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo">
      <div class="accordion-body">
        <!--Checkboxes for subsample filtering-->
        <div class="row">
          <div class="col-md-2">
            <div class="form-check form-switch form-check-inline">
              <input class="form-check-input" type="checkbox" id="Sample1" name="Sample1" value="yes" checked>
              <label class="form-check-label" for="SampleI"> Sample 1</label>
            </div>
          </div>
          <div class="col-md-2">
            <div class="form-check form-switch form-check-inline">
              <input class="form-check-input" type="checkbox" id="Sample2" name="Sample2" value="yes" checked>
              <label class="form-check-label" for="SampleII"> Sample 2</label>
            </div>
          </div>
          <% if user_signed_in? %>
          <div class="col-md-2">
            <div class="form-check form-switch form-check-inline">
              <input class="form-check-input" type="checkbox" id="BadWeather" name="BadWeather" value="yes" checked> 
              <label class="form-check-label" for="BadWeather"> Bad Weather</label>
            </div>
          </div>
          <%end%>
          <div class="col-md-2">
            <div class="form-check form-switch form-check-inline">
              <input class="form-check-input" type="checkbox" id="Calibrator" name="Calibrator" value="yes" checked> 
              <label class="form-check-label" for="Calibrator"> Calibrator</label>
            </div>
          </div>
          <div class="col-md-2">
            <div class="form-check form-switch form-check-inline">
              <input class="form-check-input" type="checkbox" id="Other" name="Other" value="yes" checked> 
              <label class="form-check-label" for="Other"> Other</label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="accordion-item">
    <h2 class="accordion-header" id="headingThree">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="true" aria-controls="collapseThree">
        Flux Density Filters
      </button>
    </h2>
    <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree">
      <div class="accordion-body">
        <div class="form-group">

          <div class="row">
            <div class="col-md-2">
              <label for="20mm_lower_limit">Ø S 20mm from</label>
              <input type="text" class="form-control" id="20mm_lower_limit" placeholder="lower limit in mJy">
            </div>
            <div class="col-md-2">
              <label for="20mm_upper_limit">to</label>
              <input type="text" class="form-control" id="20mm_upper_limit" placeholder="upper limit in mJy">
            </div>

            <div class="col-md-2">
              <label for="20mm_lower_limit">Ø S 14mm from</label>
              <input type="text" class="form-control" id="14mm_lower_limit" placeholder="lower limit in mJy">
            </div>
            <div class="col-md-2">
              <label for="20mm_upper_limit">to</label>
              <input type="text" class="form-control" id="14mm_upper_limit" placeholder="upper limit in mJy">
            </div>

            <div class="col-md-2">
              <label for="20mm_lower_limit">Ø S 7mm from</label>
              <input type="text" class="form-control" id="7mm_lower_limit" placeholder="lower limit in mJy">
            </div>
            <div class="col-md-2">
              <label for="20mm_upper_limit">to</label>
              <input type="text" class="form-control" id="7mm_upper_limit" placeholder="upper limit in mJy">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="accordion-item">
    <h2 class="accordion-header" id="headingFour">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="true" aria-controls="collapseFour">
        Search & Additional Filters
      </button>
    </h2>
    <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour">
      <div class="accordion-body">
        <div class="row">

          <div class="col-md-3">
            <label for="SearchJ2000">Search J2000 Name</label>
            <input type="text" class="form-control" id="SearchJ2000" placeholder="enter search">
          </div>

          <div class="col-md-3">
            <label for="SearchAlt">Search Alt Name</label>
            <input type="text" class="form-control" id="SearchAlt" placeholder="enter search">
          </div>

          <div class="col-md-3">
            <label for="SelectDropped">Neutrino Association</label>
            <select class="form-select" id="SelectNeutrino" name="SelectNeutrino">
              <option selected value="0">All</option>
              <option value="1">Exclude all Neutrino Sources</option>
              <option value="2">Only Neutrino Sources</option>
              
            </select>
          </div>

          <div class="col-md-3">
            <label for="SelectDropped">Drop Status</label>
            <select class="form-select" id="SelectDropped" name="SelectDropped">
              <option selected value="0">All</option>
              <option value="1">Exclude Dropped Sources</option>
              <option value="2">Only Dropped Sources</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</br>

<%if user_signed_in? %>
  <button id="export_button" class="btn btn-success" data-table='telamon_targetlist'>Export to CSV File</button>
  <p></p>
<%end%>

<div class="table-responsive">
<table id="telamon_targetlist" class="table table-hover table-striped table-bordered">
  <thead class="table-dark text-center">
    <tr>
      <th>J2000 Name</th>
      <th>Alt Name</th>
      <th>Class</th>
      <th>Category</th>
      <th>Ø 20mm [mJy]</th>
      <th>Ø 14mm [mJy]</th>
      <th>Ø 7mm [mJy]</th>
      <th>Redshift</th>
      <th>RA (J2000)</th>
      <th>DEC (J2000)</th>
      <th>NED</th>
      <th>SIMBAD</th>
      <th>TeVCat</th>
      <% if user_signed_in? && current_user.admin? %>
        <th colspan="2"></th>
      <%end%>
    </tr>
  </thead>

  <tbody>

    <% @sources.order("j2000_name").each do |source| %>

      <%print_check=true%>
      <% if !user_signed_in? %>
        <%source.source_categories.each do |cat| %>
          <% if cat.name == "Bad Weather" %>
            <%print_check=false%>
          <% end %>
        <%end%>
      <% end %>

      <% if print_check %>
        <tr>
          <td><%= link_to source.j2000_name, source %></td>
          <td><%= source.alt_name %></td>
          <td><%= source.source_class %></td>
          <td>
            <% source.source_categories.each do |cat| %>
              <%=cat.name%>
            <%end%>
          </td>
          <td><%= source.aver(14,17) %></td>
          <td><%= source.aver(19,25) %></td>
          <td><%= source.aver(36,44) %></td>
          <td><%= source.redshift %></td>
          <td><%= source.ra %></td>
          <td><%= source.decl %></td>
          <% if source.alt_name %>
            <td><%= link_to(image_tag("ned", width: "30"), "https://ned.ipac.caltech.edu/byname?objname="+source.alt_name.gsub("+","%2B")+"&hconst=67.8&omegam=0.308&omegav=0.692&wmap=4&corr_z=1",target: "_blank", rel:"noopener noreferrer")%></td>
            <td><%= link_to(image_tag("simbad",height: "30"), "http://simbad.harvard.edu/simbad/sim-basic?submit=SIMBAD+search&Ident="+source.alt_name.gsub("+","%2B"),target: "_blank", rel:"noopener noreferrer")%></td>
          <% else %>
            <td><%= link_to(image_tag("ned", width: "30"), "https://ned.ipac.caltech.edu/byname?objname="+source.j2000_name.gsub("+","%2B")+"&hconst=67.8&omegam=0.308&omegav=0.692&wmap=4&corr_z=1",target: "_blank", rel:"noopener noreferrer")%></td>
            <td><%= link_to(image_tag("simbad",height: "30"), "http://simbad.harvard.edu/simbad/sim-basic?submit=SIMBAD+search&Ident="+source.j2000_name.gsub("+","%2B"),target: "_blank", rel:"noopener noreferrer")%></td>
          <% end %>
          <td><%=if source.tevcat_url != "http://tevcat2.uchicago.edu/" then link_to(image_tag("tevcat",height: "25"), source.tevcat_url,target: "_blank", rel:"noopener noreferrer") end%></td>
          <% if user_signed_in? && current_user.admin? %>
            <td><%= link_to 'Edit', edit_source_path(source), class: "btn btn-outline-success btn-sm" %></td>
            <td><%= link_to 'Delete', source, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-outline-danger btn-sm" %></td>
          <%end%>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>
</div>

<br>
